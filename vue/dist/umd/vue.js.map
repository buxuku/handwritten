{"version":3,"file":"vue.js","sources":["../../utils.js","../../observer/array.js","../../observer/index.js","../../initState.js","../../compile/index.js","../../init.js","../../index.js"],"sourcesContent":["export function isFunction(value){\n    return typeof value === 'function';\n}\n\nexport function isObject(data){\n    return typeof data === 'object' && data !== null;\n}","/**\n * 对array的变异方法进行重写，以实现array数组的修改劫持功能\n * @type {*[]}\n */\nlet oldArrayPrototype = Array.prototype;\nexport let arrayMethods = Object.create(oldArrayPrototype);\n\nconst methods = [ // array的七个变异方法，会改变原数据\n    'push',\n    'shift',\n    'unshift',\n    'pop',\n    'reverse',\n    'sort',\n    'splice',\n]\nmethods.forEach(method=>{\n    arrayMethods[method] = function(...args){\n        oldArrayPrototype[method].call(this, ...args); // oldArrayPrototype是原来Array上面的方法，所以需要改变this指向具体操作的数组\n        let ob = this.__ob__;\n        let inserted;\n        switch(method){\n            case 'push':\n            case 'unshift':\n                inserted = args;\n                break;\n            case 'splice':\n                inserted = args.slice(2);\n                break;\n            default:\n                break;\n        }\n        if(inserted) ob.observerArray(inserted); //对新增的数据需要进行劫持\n    }\n})","/**\n * 对数据进行劫持观测，如果是对象，不断递归，遍历对象所有的层级进行劫持\n * 对数组类型的重写原生数组的变异方法，并对数组内的非基本数据类型再次进行劫持\n */\nimport { isObject } from \"../utils\";\nimport { arrayMethods } from \"./array\";\n\nfunction defineReactive(data, key, value) {\n  observer(value); // value是一个对象，需要递归进行劫持，所以性能也差\n  Object.defineProperty(data, key, {\n    get() {\n      return value;\n    },\n    set(newValue) {\n      value = newValue;\n      observer(newValue); // newValue可能是一个对象，也需要进行劫持\n    }\n  });\n}\n\n// 类有类型，对象无类型，用类的方法来实现可以判断出数据是否是该类的实例\nclass Observer {\n  constructor(data) {\n    console.log(\"data\", data);\n    Object.defineProperty(data, \"__ob__\", {\n      value: this,\n      enumerable: false // 不可被枚举\n    });\n    // data.__ob__ = this; //直接挂载到data上面会在后面递归中被枚举出来，造成死循环\n    if (Array.isArray(data)) {\n      // 处理data是数组的情况，避免每个item都生成get和set方法\n      data.__proto__ = arrayMethods; //只有被劫持的数组才会被重写操作方法，其它地方的数组不会受影响。\n      this.observerArray(data);\n    } else {\n      this.walk(data);\n    }\n  }\n\n  observerArray(data) {\n    // 对数组中的对象进行劫持\n    data.forEach(item => observer(item));\n  }\n\n  walk(data) {\n    Object.keys(data).forEach(key => {\n      defineReactive(data, key, data[key]);\n    });\n  }\n}\n\nexport function observer(data) {\n  if (!isObject(data)) {\n    return; // vue中只对对象类型的数据进行劫持\n  }\n  if (data.__ob__) {\n    return; //如果数据已经被劫持过了，就无需再次进行劫持操作 ?什么情况下会出现\n  }\n  return new Observer(data);\n}\n","import { isFunction } from \"./utils\";\nimport { observer } from \"./observer/index.js\";\n\nexport function initState(vm) {\n  const opts = vm.$options;\n  if (opts.data) {\n    initData(vm);\n  }\n}\nfunction proxy(vm, source, key) {\n  Object.defineProperty(vm, key, {\n    get() {\n      return vm[source][key];\n    },\n    set(newValue) {\n      vm[source][key] = newValue;\n    }\n  });\n}\nfunction initData(vm) {\n  let { data } = vm.$options;\n  data = vm._data = isFunction(data) ? data.call(vm) : data; // data和vm._data引用同一内容空间\n  for (let key in data) {\n    proxy(vm, \"_data\", key); // 将_data上面的数据全部代理给vm上\n  }\n  observer(data);\n}\n","\nexport function compileToFunction(template){\n    console.log('template', template);\n}","import { initState } from \"./initState\";\nimport { compileToFunction } from \"./compile/index\";\n\nexport function initMixin(Vue) {\n  Vue.prototype._init = function(options) {\n    const vm = this;\n    vm.$options = options; //用户传入的属性全部挂载到$开头下面\n    initState(vm);\n    if (vm.$options.el) {\n      vm.$mount(vm.$options.el);\n    }\n  };\n  Vue.prototype.$mount = function(el) {\n    const vm = this;\n    const options = vm.$options;\n    el = document.querySelector(el);\n    if (!options.render) {\n      let template = vm.$options.template;\n      if (!template && el) {\n        template = el.outerHTML;\n        let render = compileToFunction(template);\n        options.render = render;\n      }\n    }\n  };\n}\n","import { initMixin } from './init';\n\nfunction Vue(options){\n    this._init(options);\n}\n\ninitMixin(Vue);\n\nexport default Vue;"],"names":["isFunction","value","isObject","data","oldArrayPrototype","Array","prototype","arrayMethods","Object","create","methods","forEach","method","args","call","ob","__ob__","inserted","slice","observerArray","defineReactive","key","observer","defineProperty","get","set","newValue","Observer","constructor","console","log","enumerable","isArray","__proto__","walk","item","keys","initState","vm","opts","$options","initData","proxy","source","_data","compileToFunction","template","initMixin","Vue","_init","options","el","$mount","document","querySelector","render","outerHTML"],"mappings":"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"}